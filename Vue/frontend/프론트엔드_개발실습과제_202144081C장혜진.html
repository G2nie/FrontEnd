<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>C202144081장혜진</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        h1 {
            text-align: center;
            margin-top: 20px;
        }

        table {
            border-collapse: collapse;
            width: 100%;
        }

        th, td {
            border: 1px solid #ffffff;
            padding: 8px;
            text-align: center;
        }

        tr:nth-child(even) {
            background-color: #e9edf4;
        }

        tr:nth-child(odd) {
            background-color: #d0d8e8;
        }

        td.left-align {
            text-align: left;
        }

        th {
            font-weight: bold;
            color: white;
            background-color: #5082bd;
        }

        .red-text {
            color: red;
        }

        button {
            background-color: #808080;
            color: white;
            padding: 5px 10px;
            border: #5082bd solid;
            cursor: pointer;
            margin-right: 5px;
            float: right;
            font-size: 20px;
        }
    </style>
</head>
<body>
<h1>Front-end 과제</h1>
<div id="app">
    <ul>
        <!-- 학년 테이블 선택 체크박스 -->
        <div v-for="(table, index) in tables" :key="index">
            <input type="checkbox" :id="`checkbox-${index}`" v-model="selectedTables" :value="index">
            <label :for="`checkbox-${index}`">{{ table.name }}</label>
        </div>

        <!-- 선택한 테이블 표시 -->
        <div v-for="(table, index) in selectedTables" :key="index">
            <h2>{{ tables[table].name }}</h2>
            <!-- 행 추가, 삭제, 저장 버튼 -->
            <button @click="calculate(table)">저장</button>
            <button @click="deleteRow(table)">삭제</button>
            <button @click="addRow(table)">추가</button>

            <!-- 테이블 -->
            <table>
                <thead>
                <tr>
                    <th>이수</th>
                    <th>필수</th>
                    <th>과목명</th>
                    <th>학점</th>
                    <th>출석점수</th>
                    <th>과제점수</th>
                    <th>중간고사</th>
                    <th>기말고사</th>
                    <th>총점</th>
                    <th>평균</th>
                    <th>성적</th>
                </tr>
                </thead>
                <tbody>
                <!-- 테이블 행을 반복하며 데이터 표시 -->
                <tr v-for="(row, rowIndex) in tables[table].rows" :key="rowIndex">
                    <td>
                        <select v-model="row.subject">
                            <option value="교양">교양</option>
                            <option value="전공">전공</option>
                        </select>
                    </td>
                    <td>
                        <select v-model="row.required">
                            <option value="필수">필수</option>
                            <option value="선택">선택</option>
                        </select>
                    </td>
                    <!-- contenteditable = 사용자가 값 변경 -->
                    <td contenteditable="true" @input="updateValue(row, 'name', $event)">{{ row.name }}</td>
                    <td contenteditable="true" @input="updateValue(row, 'credit', $event)">{{ row.credit }}</td>
                    <td contenteditable="true" @input="updateValue(row, 'attendance', $event)">{{ row.attendance }}</td>
                    <td contenteditable="true" @input="updateValue(row, 'assignment', $event)">{{ row.assignments }}</td>
                    <td contenteditable="true" @input="updateValue(row, 'midterm', $event)">{{ row.midterm }}</td>
                    <td contenteditable="true" @input="updateValue(row, 'final', $event)">{{ row.final }}</td>
                    <td>{{ row.total }}</td>
                    <td>{{ row.average }}</td>
                    <td>{{ row.grade }}</td>
                </tr>
                <!-- 합계 행 -->
                <tr id="total">
                    <td colspan="3">합계</td>
                    <td>{{ tables[table].total_credit }}</td>
                    <td>{{ tables[table].total_attendance }}</td>
                    <td>{{ tables[table].total_assignment }}</td>
                    <td>{{ tables[table].total_midterm }}</td>
                    <td>{{ tables[table].total_final }}</td>
                    <td>{{ tables[table].total_total }}</td>
                    <td>{{ tables[table].total_average }}</td>
                    <td></td>
                </tr>
                </tbody>
            </table>
        </div>
    </ul>
</div>
<script>
    const app = Vue.createApp({
        // 각 학년 테이블
        data() {
            return {
                tables: [
                    {name: '1학년', rows: []},
                    {name: '2학년', rows: []},
                    {name: '3학년', rows: []}
                ],
                selectedTables: [] // 체크된 테이블을 저장할 배열
            };
        },
        methods: {
            updateValue(row, field, event) {
                // 숫자 형태의 데이터는 parseFloat을 사용하여 변환
                if (['credit', 'attendance', 'assignments', 'midterm', 'final'].includes(field)) {
                    row[field] = parseFloat(event.target.textContent) || 0;
                } else {
                    // 과목명과 같은 문자열 데이터는 직접 할당
                    row[field] = event.target.textContent;
                }
                // 데이터 변경 후 총점, 평균, 성적을 재계산
                this.calculate(this.tables.indexOf(row.table));
            },

            // 행 추가
            addRow(tableIndex) {
                this.tables[tableIndex].rows.push({
                    subject: '교양',
                    required: '필수',
                    name: '',
                    credit: 0,
                    attendance: 0,
                    assignments: 0,
                    midterm: 0,
                    final: 0,
                    total: 0,
                    average: 0,
                    grade: ''
                });
            },
            // 행 삭제
            deleteRow(tableIndex) {
                if (this.tables[tableIndex].rows.length > 0) {
                    this.tables[tableIndex].rows.pop();
                }
            },
            // 저장(=계산)
            calculate(tableIndex) {
                const table = this.tables[tableIndex];
                // 합계를 위한 변수 초기화
                table.total_credit = 0;
                table.total_attendance = 0;
                table.total_assignment = 0;
                table.total_midterm = 0;
                table.total_final = 0;
                table.total_total = 0;
                table.total_average = 0;

                for (const row of table.rows) {
                    // 각 점수를 파싱하고 유효하지 않은 값(예: 빈 문자열)이 있을 경우 0으로 처리
                    const attendance = parseFloat(row.attendance) || 0;
                    const assignment = parseFloat(row.assignment) || 0;
                    const midterm = parseFloat(row.midterm) || 0;
                    const final = parseFloat(row.final) || 0;

                    // 합계를 table 객체에 저장
                    table.total_credit += parseFloat(row.credit) || 0;
                    table.total_attendance += parseFloat(row.attendance) || 0;
                    table.total_assignment += parseFloat(row.assignment) || 0;
                    table.total_midterm += parseFloat(row.midterm) || 0;
                    table.total_final += parseFloat(row.final) || 0;
                    table.total_total += parseFloat(row.total) || 0;

                    // 과목별 총점 계산
                    row.total = attendance + assignment + midterm + final;
                    // 과목별 성적 계산
                    if (row.total >= 95) {
                        row.grade = 'A+';
                    } else if (row.total >= 90) {
                        row.grade = 'A0';
                    } else if (row.total >= 85) {
                        row.grade = 'B+';
                    } else if (row.total >= 80) {
                        row.grade = 'B0';
                    } else if (row.total >= 75) {
                        row.grade = 'C+';
                    } else if (row.total >= 70) {
                        row.grade = 'C0';
                    } else if (row.total >= 65) {
                        row.grade = 'D+';
                    } else if (row.total >= 60) {
                        row.grade = 'D0';
                    } else if (row.total = 0) {
                        row.grade = 'F';
                    } else {
                        row.grade = 'F';
                    }
                    // 합계 행 평균 계산 전체 총점 / 과목수
                    table.total_average = table.rows.length > 0 ? table.total_total / table.rows.length : 0;
                }
            },
        },
    });
    app.mount('#app');
</script>
</body>
</html>
